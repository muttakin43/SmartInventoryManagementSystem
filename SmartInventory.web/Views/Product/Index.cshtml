@model IEnumerable<SmartInventory.Model.Product>

﻿@{
    ViewData["HeaderTitle"] = "Products";
    ViewData["BreadcrumbFirst"] = "Home";
    ViewData["BreadcrumbActive"] = "Products List";
}

<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <a asp-action="Create" class="btn btn-success btn-sm">Create New Product</a>
                </h3>
            </div>
            <div class="card-body">
                @Html.AntiForgeryToken()
                <style>
                    #productsDataTable th,
                    #productsDataTable td {
                        vertical-align: middle !important;
                        text-align: center;
                    }
                </style>
                <table id="productsDataTable" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Description</th>
                            <th>Price</th>
                            <th>StockQuantit</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- jQuery -->
    <script src="~/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#productsDataTable").DataTable({
                "processing": true,
                "serverSide": true,
                "responsive": true,
                "autoWidth": false,
                "ajax": {
                    "url": "@Url.Action("GetDataTables", "Product")",
                    "type": "POST",
                    "data": function (d) {
                        // Map DataTables parameters to our request format
                        var request = {
                            draw: d.draw,
                            start: d.start,
                            length: d.length,
                            search: {
                                value: d.search.value,
                                regex: d.search.regex
                            },
                            order: d.order.map(function (o) {
                                return {
                                    column: o.column,
                                    dir: o.dir
                                };
                            }),
                            columns: d.columns.map(function (c) {
                                return {
                                    data: c.data,
                                    name: c.name,
                                    searchable: c.searchable,
                                    orderable: c.orderable,
                                    search: {
                                        value: c.search.value,
                                        regex: c.search.regex
                                    }
                                };
                            })
                        };
                        return request;
                    }
                },
                        "columns": [
            { "data": "productName", "name": "ProductName", "orderable": true, "searchable": true },
            { "data": "description", "name": "Description", "orderable": true, "searchable": true },
            { "data": "price", "name": "Price", "orderable": true, "searchable": true },
            { "data": "stockQuantit", "name": "StockQuantit", "orderable": true, "searchable": true },
            {
                "data": null,
                "name": "Action",
                "orderable": false,
                "searchable": false,
                "render": function (data, type, row) {
                    var editUrl = '@Url.Action("Edit", "Product")/' + row.id;
                    var detailsUrl = '@Url.Action("Details", "Product")/' + row.id;
                    var deleteUrl = '@Url.Action("Delete", "Product")';

                    var editLink = '<a href="' + editUrl + '" class="btn btn-sm btn-primary mr-1">Edit</a>';
                    var detailsLink = '<a href="' + detailsUrl + '" class="btn btn-sm btn-info mr-1">Details</a>';
                    var productName = (row.productName || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    var deleteForm = '<form action="' + deleteUrl + '" method="post" style="display: inline;" onsubmit="return confirmDelete(\'' + productName + '\');">' +
                        '<input name="__RequestVerificationToken" type="hidden" value="' + $('input[name="__RequestVerificationToken"]').val() + '" />' +
                        '<input type="hidden" name="id" value="' + row.id + '" />' +
                        '<button type="submit" class="btn btn-sm btn-danger">Delete</button>' +
                        '</form>';
                    return editLink + ' ' + detailsLink + ' ' + deleteForm;
                }
            }
        ]
            });
        });

        function confirmDelete(productName) {
            return confirm('Are you sure you want to delete "' + productName + '"? This action cannot be undone.');
        }
    </script>
}
